---
title: "Cao_Xiping_AssignmentV"
author: "Xiping Cao"
date: "2/2/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#### Setting up a new GitHub repository
My project repository: https://github.com/cxp0330/AssignmentV.git

####Interacting with the API - the basics
```{r message=FALSE}
#load packages
rm(list = ls())

library(jsonlite)
library(httr)
library(rlist)
library(tidyverse)
library(naniar)

# set working directory:
#setwd("")
```

#### Interacting with the API - the basics
```{r message=FALSE}
# get API key
#APIkey <- "7elxdku9GGG5k8j0Xm8KWdANDgecHMV0"
source("Cao_Xiping_AssignmentV.R")

# get information from the API
Venues <- GET("https://app.ticketmaster.com/discovery/v2/venues?",
                    query =list(apikey = APIkey,
                                local = "*",
                                countryCode = "DE"))
Venues_content <- content(Venues)

# total number of venues
n <- as.numeric(Venues_content[["page"]][["totalElements"]])
pages <- floor(n/20)
remainder <- n-20*pages

# extract information from the resulting list
Venues_table <- tibble(name = character(20),
                       city = character(20),
                       postalCode =character(20),
                       address = character(20),
                       url = character(20),
                       longitude = character(20),
                       latitude = character(20))
for (i in 1:20) {
  Venues_table$name[i] <- Venues_content[["_embedded"]][["venues"]][[i]][["name"]]
  Venues_table$city[i] <- Venues_content[["_embedded"]][["venues"]][[i]][["city"]][["name"]]
  Venues_table$postalCode[i] <- Venues_content[["_embedded"]][["venues"]][[i]][["postalCode"]]
  Venues_table$address[i] <- Venues_content[["_embedded"]][["venues"]][[1]][["address"]][["line1"]]
  Venues_table$url[i] <- Venues_content[["_embedded"]][["venues"]][[i]][["url"]]
  if(is.null(Venues_content[["_embedded"]][["venues"]][[i]][["location"]][["longitude"]])){
    next
  } else {
    Venues_table$longitude[i] <- Venues_content[["_embedded"]][["venues"]][[i]][["location"]][["longitude"]]
  }
    if(is.null(Venues_content[["_embedded"]][["venues"]][[i]][["location"]][["latitude"]])){
    next
  } else {
    Venues_table$latitude[i] <- Venues_content[["_embedded"]][["venues"]][[i]][["location"]][["latitude"]]
  }
  
}
```


























